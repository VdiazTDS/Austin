<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>TDS-PAK Sales Polygons Viewer</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet" />

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <!-- App CSS -->
  <link rel="stylesheet" href="style.css" />

  <link rel="icon" href="favicon.ico" />
</head>

<body>
  <!-- ================= HEADER ================= -->
  <header>
    <h1>TDS-PAK Sales Polygons Viewer</h1>
    <p>Upload, manage, and visualize TDS-PAK sales polygon GeoJSON layers</p>
    <button id="mobileMenuBtn">â˜° Menu</button>
  </header>

  <!-- ================= MAIN LAYOUT ================= -->
  <div class="app-container">

    <!-- Desktop sidebar collapse toggle -->
    <button id="toggleSidebarBtn" class="sidebar-toggle">â®</button>

    <!-- ================= SIDEBAR ================= -->
    <aside class="sidebar">

      <!-- Upload -->
      <div id="dropZone">ğŸ“‚ Drag & drop GeoJSON or click to upload</div>

      <!-- Saved GeoJSON Layers -->
      <div class="filter-group">
        <strong>GeoJSON Layers</strong>
        <ul id="savedFiles"></ul>
      </div>

      <!-- Collapsible Help Panel -->
      <div class="filter-group help-panel">
        <button id="helpToggle" class="help-toggle">â“ Help & Instructions</button>

        <div id="helpContent" class="help-content">
          <ul>
            <li>ğŸ“¤ <strong>Upload files:</strong> Drag & drop a GeoJSON file into the upload box or click it to choose a file.</li>
            <li>ğŸ“‚ <strong>Open existing layers:</strong> Click <b>Open</b> next to any saved file to display it on the map.</li>
            <li>ğŸ¨ <strong>Change layer colors:</strong> Use the color picker in the legend to customize how each layer appears.</li>
            <li>ğŸ—ºï¸ <strong>Reset map view:</strong> Clears all open layers, removes the legend, and zooms back to the world view.</li>
            <li>ğŸ§­ <strong>Change basemap:</strong> Use the Streets/Satellite dropdown to switch map styles.</li>
          </ul>
        </div>
      </div>

      <!-- Reset Map -->
      <button id="resetMapBtn">Reset Map View</button>

      <!-- Basemap Selector -->
      <select id="baseMapSelect">
        <option value="streets">Streets</option>
        <option value="satellite">Satellite</option>
      </select>

      <!-- ================= LEGEND ================= -->
      <div id="mapLegend" class="map-legend" style="display:none; margin-top:10px;">
        <strong>Visible Layers</strong>
        <ul id="legendList"></ul>
      </div>

    </aside>

    <!-- ================= MAP ================= -->
    <main class="map-container">
      <div id="map"></div>

      <!-- ================= MAP LEGEND ================= -->
      <div id="mapLegend" class="map-legend" style="display:none;">
        <strong>Visible Layers</strong>
        <ul id="legendList"></ul>
      </div>
    </main>

  </div>

  <!-- ================= SCRIPTS ================= -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- App JS -->
  <script src="app.js"></script>
  <script>
    // =============================================================
    // COLLAPSIBLE HELP PANEL TOGGLE
    // Adds expand/collapse behavior for Help section
    // =============================================================
    const helpToggle = document.getElementById("helpToggle");
    const helpContent = document.getElementById("helpContent");

    if (helpToggle && helpContent) {
      helpToggle.addEventListener("click", () => {
        const isOpen = helpContent.classList.toggle("open");
        helpToggle.textContent = isOpen ? "â–¼ Help & Instructions" : "â–¶ Help & Instructions";
      });
    }
  </script>
</body>
</html>
